<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Open Wiki</title>
</head>
<body>
<h1>Open Wiki</h1>

<input id="title" placeholder="Page title">
<br><br>
<textarea id="content" rows="10" cols="60"></textarea>
<br>
<button onclick="save()">Save</button>

<h2>Pages</h2>
<ul id="list"></ul>

<div id="page"></div>

<script>
async function load(){
  const r = await fetch('/api/pages');
  const pages = await r.json();
  list.innerHTML='';
  pages.forEach(p=>{
    const li = document.createElement('li');
    li.innerHTML = `<a href="#" onclick="openPage('${p.title}')">${p.title}</a>`;
    list.appendChild(li);
  });
}
async function openPage(title){
  const r = await fetch('/api/page/'+title);
  const p = await r.json();
  page.innerHTML = `<h2>${p.title}</h2>` + p.rendered;
  document.getElementById('title').value=p.title;
  document.getElementById('content').value=p.content;
}
async function save(){
  await fetch('/api/save',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      title:title.value,
      content:content.value
    })
  });
  load();
}
load();
</script>
</body>
</html>
